<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin Iklan - Lapak Banjarharjo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center">
    <div class="w-full max-w-[480px] min-h-screen bg-white p-6 shadow-lg">
        <h1 class="text-2xl font-black text-gray-800 mb-2">Panel Iklan ğŸ“¢</h1>
        <p class="text-sm text-gray-500 mb-6">Ganti banner iklan beranda dari sini, Lur.</p>

        <div class="space-y-6">
            <div class="p-4 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50">
                <label class="block font-bold text-sm mb-2 text-green-600">Slide Iklan 1</label>
                <input type="file" id="file1" accept="image/*" class="text-xs mb-3 block w-full">
                <input type="text" id="link1" placeholder="Link WA (Contoh: 628xxx)" class="w-full p-2 border rounded-lg text-sm mb-3 focus:outline-green-500">
                <button id="btn1" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl text-sm transition-all">Update Slide 1</button>
            </div>

            <div class="p-4 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50">
                <label class="block font-bold text-sm mb-2 text-green-600">Slide Iklan 2</label>
                <input type="file" id="file2" accept="image/*" class="text-xs mb-3 block w-full">
                <input type="text" id="link2" placeholder="Link WA (Contoh: 628xxx)" class="w-full p-2 border rounded-lg text-sm mb-3 focus:outline-green-500">
                <button id="btn2" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl text-sm transition-all">Update Slide 2</button>
            </div>
        </div>

        <p class="mt-10 text-[10px] text-center text-gray-400 font-medium uppercase tracking-widest">Khusus Admin Lapak Banjarharjo</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAowYbcfC9RsMCxKf2ZmwvTiLvooKaWI5U",
            databaseURL: "https://lapak-banjarharjo-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lapak-banjarharjo"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- KUNCI API BARU DISINI ---
        const IMGBB_API_KEY = "187f5e88849646b840811e586884869a"; 

        async function updateIklan(id) {
            const fileInput = document.getElementById('file' + id);
            const linkInput = document.getElementById('link' + id);
            const btn = document.getElementById('btn' + id);

            if (!fileInput.files[0]) return alert("Pilih foto dulu, Lur!");

            const originalBtnText = btn.innerText;
            btn.innerText = "â³ Sedang Upload...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append("image", fileInput.files[0]);

            try {
                // Pakai API Key yang baru
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: "POST",
                    body: formData
                });

                const resData = await response.json();

                if (resData.success) {
                    const imageUrl = resData.data.url;

                    await set(ref(db, 'ads/slide' + id), {
                        url: imageUrl,
                        link: linkInput.value || "6285647087424"
                    });

                    alert("âœ… Berhasil! Iklan sudah tayang.");
                    fileInput.value = "";
                } else {
                    throw new Error(resData.error.message);
                }

            } catch (err) {
                alert("âŒ Gagal: " + err.message);
            } finally {
                btn.innerText = originalBtnText;
                btn.disabled = false;
            }
        }

        document.getElementById('btn1').addEventListener('click', () => updateIklan(1));
        document.getElementById('btn2').addEventListener('click', () => updateIklan(2));
    </script>
</body>
</html>