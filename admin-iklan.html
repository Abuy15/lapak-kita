<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin Iklan - Lapak Banjarharjo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center">
    <div class="w-full max-w-[480px] min-h-screen bg-white p-6 shadow-lg">
        <h1 class="text-2xl font-black text-gray-800 mb-2">Panel Iklan ðŸ“¢</h1>
        <p class="text-sm text-gray-500 mb-6">Ganti banner iklan beranda dari sini, Lur.</p>

        <div class="space-y-6">
            <div class="p-4 border-2 border-dashed border-gray-200 rounded-2xl">
                <label class="block font-bold text-sm mb-2 text-green-600">Slide Iklan 1</label>
                <input type="file" id="file1" class="text-xs mb-2">
                <input type="text" id="link1" placeholder="Link WA (Contoh: 628xxx)" class="w-full p-2 border rounded-lg text-xs mb-2">
                <button onclick="updateIklan(1)" id="btn1" class="w-full bg-green-600 text-white font-bold py-2 rounded-xl text-xs">Update Slide 1</button>
            </div>

            <div class="p-4 border-2 border-dashed border-gray-200 rounded-2xl">
                <label class="block font-bold text-sm mb-2 text-green-600">Slide Iklan 2</label>
                <input type="file" id="file2" class="text-xs mb-2">
                <input type="text" id="link2" placeholder="Link WA (Contoh: 628xxx)" class="w-full p-2 border rounded-lg text-xs mb-2">
                <button onclick="updateIklan(2)" id="btn2" class="w-full bg-green-600 text-white font-bold py-2 rounded-xl text-xs">Update Slide 2</button>
            </div>
        </div>

        <p class="mt-10 text-[10px] text-center text-gray-400 font-medium">Khusus Admin Lapak Banjarharjo</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAowYbcfC9RsMCxKf2ZmwvTiLvooKaWI5U",
            databaseURL: "https://lapak-banjarharjo-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lapak-banjarharjo"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.updateIklan = async (id) => {
            const fileInput = document.getElementById('file' + id);
            const linkInput = document.getElementById('link' + id);
            const btn = document.getElementById('btn' + id);

            if (!fileInput.files[0]) return alert("Pilih foto dulu, Lur!");

            btn.innerText = "Sabar, lagi upload...";
            btn.disabled = true;

            // Upload gambar ke ImgBB (biar database enteng)
            const formData = new FormData();
            formData.append("image", fileInput.files[0]);

            try {
                const response = await fetch("https://api.imgbb.com/1/upload?key=69837a346e9df5f564f26019a141b777", {
                    method: "POST",
                    body: formData
                });
                const resData = await response.json();
                const imageUrl = resData.data.url;

                // Simpan URL gambar ke Firebase
                await set(ref(db, 'ads/slide' + id), {
                    url: imageUrl,
                    link: linkInput.value || "6285647087424"
                });

                alert("Iklan Slide " + id + " Berhasil Diganti!");
            } catch (err) {
                alert("Gagal: " + err.message);
            } finally {
                btn.innerText = "Update Slide " + id;
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>