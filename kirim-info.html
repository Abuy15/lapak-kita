<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirim Info - Lapak Banjarharjo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 flex justify-center">

    <div class="w-full max-w-[480px] min-h-screen bg-white shadow-lg pb-10">
        
        <header class="bg-green-600 p-4 text-white flex items-center gap-4 shadow-md sticky top-0 z-50">
            <a href="info.html" class="active:scale-90 transition-transform"><i class="fas fa-arrow-left text-lg"></i></a>
            <h1 class="text-xl font-bold uppercase italic tracking-wider">Kirim Kabar</h1>
        </header>

        <form id="formInfo" class="p-5 space-y-4">
            <div>
                <label class="block text-xs font-black text-gray-400 mb-2 uppercase tracking-widest">Jenis Informasi</label>
                <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer">
                        <input type="radio" name="kat" value="Berita Desa" class="peer hidden" checked>
                        <div class="text-center py-3 border-2 rounded-2xl peer-checked:bg-green-600 peer-checked:text-white peer-checked:border-green-600 text-[9px] font-bold uppercase transition-all border-gray-100 bg-gray-50">Berita</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="kat" value="Kegiatan" class="peer hidden">
                        <div class="text-center py-3 border-2 rounded-2xl peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 text-[9px] font-bold uppercase transition-all border-gray-100 bg-gray-50">Kegiatan</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="kat" value="Kehilangan" class="peer hidden">
                        <div class="text-center py-3 border-2 rounded-2xl peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-600 text-[9px] font-bold uppercase transition-all border-gray-100 bg-gray-50">Kehilangan</div>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-xs font-black text-gray-400 mb-2 uppercase tracking-widest">Judul Info</label>
                <input type="text" id="judul" required placeholder="Contoh: Ono kunci motor nemu..." class="w-full p-4 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-green-500 focus:outline-none font-bold text-sm">
            </div>

            <div>
                <label class="block text-xs font-black text-gray-400 mb-2 uppercase tracking-widest">Penjelasan Lengkap</label>
                <textarea id="deskripsi" required rows="4" placeholder="Ceritaken detail kabare, Lur..." class="w-full p-4 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-green-500 focus:outline-none text-sm"></textarea>
            </div>

            <div>
                <label class="block text-xs font-black text-gray-400 mb-2 uppercase tracking-widest">Foto Pendukung</label>
                <div id="preview-area" class="hidden mb-3">
                    <img id="img-preview" class="w-full h-48 object-cover rounded-2xl shadow-md border-4 border-white">
                </div>
                <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-2xl hover:bg-green-50 hover:border-green-300 cursor-pointer transition-all bg-gray-50">
                    <i class="fas fa-camera text-3xl text-gray-300"></i>
                    <span id="label-foto" class="text-[10px] font-bold text-gray-400 mt-2 uppercase">Klik nggo milih foto</span>
                    <input type="file" id="file-foto" accept="image/*" class="hidden">
                </label>
            </div>

            <button type="submit" id="btnKirim" class="w-full bg-green-600 text-white font-black py-4 rounded-2xl shadow-xl mt-6 transition active:scale-95 uppercase italic tracking-widest">
                Kirim Kabar Saiki!
            </button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAowYbcfC9RsMCxKf2ZmwvTiLvooKaWI5U",
            databaseURL: "https://lapak-banjarharjo-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lapak-banjarharjo"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const fileInput = document.getElementById('file-foto');
        const previewImg = document.getElementById('img-preview');
        const previewArea = document.getElementById('preview-area');
        const form = document.getElementById('formInfo');
        const btn = document.getElementById('btnKirim');

        let base64String = "";

        fileInput.onchange = () => {
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onloadend = () => {
                base64String = reader.result;
                previewImg.src = base64String;
                previewArea.classList.remove('hidden');
                document.getElementById('label-foto').innerText = "Ganti Foto";
            };
            if (file) { reader.readAsDataURL(file); }
        };

        form.onsubmit = async (e) => {
            e.preventDefault();
            const judul = document.getElementById('judul').value;
            const isiBerita = document.getElementById('deskripsi').value;
            const kategori = document.querySelector('input[name="kat"]:checked').value;

            btn.disabled = true;
            btn.innerHTML = `<i class="fas fa-spinner animate-spin"></i> Sedang Mengirim...`;

            try {
                const infoRef = ref(db, 'news');
                const newInfoRef = push(infoRef);
                const sekarang = new Date();
                const waktuString = sekarang.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });

                await set(newInfoRef, {
                    judul: judul,
                    isi: isiBerita,
                    kategori: kategori,
                    foto: base64String,
                    tanggal: waktuString,
                    timestamp: Date.now()
                });

                alert('✅ Kabar wis tayang, Lur!');
                window.location.href = 'info.html';
            } catch (err) {
                alert('❌ Gagal: ' + err.message);
                btn.disabled = false;
                btn.innerText = "KIRIM KE INFO DESA";
            }
        };
    </script>
</body>
</html>